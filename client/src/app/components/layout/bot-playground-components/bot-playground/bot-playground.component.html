<app-section class="game-simulation-section">

    <div class="game-simulation-title">
        <h1 class="padded">{{getSelectedAI().getName(botConfig.variant)}}</h1>
        <app-tooltip-indicator [tooltip]="getSelectedAI().getDescription(botConfig.variant)" />
    </div>

    <app-tetris-panel>
        <app-interactive-tetris-board
            [level]="getCurrentState().status.level"
            [grid]="getCurrentState().board"
            [currentPiece]="getCurrentPlacement()?.currentPlacement"
            [nextPiece]="playing ? undefined : getCurrentPlacement()?.nextPlacement"
            />

        <app-tetris-panel-item>
            <h2>Score</h2>
            <h1>{{getCurrentState().status.score}}</h1>
        </app-tetris-panel-item>
        <div class="level-lines">
            <app-tetris-panel-item>
                <h2>Lines</h2>
                <h1>{{getCurrentState().status.lines}}</h1>
            </app-tetris-panel-item>
            <app-tetris-panel-item>
                <h2>Level</h2>
                <h1>{{getCurrentState().status.level}}</h1>
            </app-tetris-panel-item>
        </div>

        <app-tetris-panel-item class="prevent-text-select">
            <app-next-box [showBackground]="false" [level]="18" [type]="getCurrentState().nextPieceType"></app-next-box>
        </app-tetris-panel-item>

        <app-tooltip-button
            label="Reset Game"
            color="#C34646"
            tooltipText="Discard current game and start a new one"
            (click)="resetGame()"/>

        <app-tooltip-button
            [label]="!playing ? 'Start Playing' : 'Pause Game'"
            [color]="!playing ? '#50C346' : '#C34646'"
            [tooltipText]="'Simulate a game from this position with ' + getSelectedAI().getName(botConfig.variant) + ' AI!'"
            (click)="!playing ? startGame() : stopGame()"/>

        <app-tetris-panel-item>
            <h2>Position #{{placementIndex}}</h2>
            <div class="nav-buttons">
                <app-fixed-size-image src="arrow_left.svg" class="arrow-button" [ngClass]="{'disabled': placementIndex <= 0}" [width]="25" (click)="goToPreviousPlacement()"></app-fixed-size-image>
                <app-fixed-size-image src="arrow_right.svg" class="arrow-button" [width]="25" (click)="goToNextPlacement()"></app-fixed-size-image>
            </div>
        </app-tetris-panel-item>

    </app-tetris-panel>
</app-section>

<div class="right-col">

    <app-section class="bot-config-section">
        <h1 class="padded">Bot Configuration</h1>
        
        <div class="bot-config-columns">
            <div class="bot-config-column left">
                <div class="dropdown">
                    <h2>AI:</h2>
                    <select [(ngModel)]="botConfig.aiType" (ngModelChange)="onAITypeChange()">
                        <option *ngFor="let type of ALL_ADAPTER_TYPES" [ngValue]="type">{{type}}</option>
                    </select>
                </div>
                <div class="dropdown">
                    <h2>Variant:</h2>
                    <select [(ngModel)]="botConfig.variant" (ngModelChange)="onAITypeChange()">
                        <option *ngFor="let variant of getSelectedAI().getVariants()" [ngValue]="variant">{{getSelectedAI().getVariantOptionString(variant)}}</option>
                    </select>
                </div>
                <div class="dropdown">
                    <h2>Input Speed:</h2>
                    <select [(ngModel)]="botConfig.inputSpeed" (ngModelChange)="onAITypeChange()">
                        <option *ngFor="let speed of ALL_INPUT_SPEEDS" [ngValue]="speed">
                            {{speed}}hz
                        </option>
                    </select>
                </div>
            </div>
            <div class="bot-config-column right">
                <div class="dropdown">
                    <h2>Start Level:</h2>
                    <select [(ngModel)]="botConfig.startLevel" (ngModelChange)="onAITypeChange()">
                        <option *ngFor="let startLevel of ALL_START_LEVELS" [ngValue]="startLevel">
                            {{startLevel}}
                        </option>
                    </select>
                </div>
            </div>
        </div>
    </app-section>

    <app-section class="statistics-section">
        <h1 class="padded">Simulation Statistics</h1>
        <div class="level-containers">
            <app-level-container level="*" [r]="66"[g]="255" [b]="0"
                [labels]="['Overall Score']"
                [averages]="stats.score.getAverage() ? [stats.score.getAverage()!.toFixed(0)] : []"
                [medians]="stats.score.getMedian() ? [stats.score.getMedian()!] : []"
                [bests]="stats.score.getBest() ? [stats.score.getBest()!] : []"
                [worsts]="stats.score.getWorst() ? [stats.score.getWorst()!] : []" />
            <app-level-container level="18" [r]="0"[g]="90" [b]="255"
                [labels]="['Subscore','Tetris rate','Right well open','Tetris ready']"
                [averages]="aggregate(18, averageFunc)"
                [medians]="aggregate(18, medianFunc)"
                [bests]="aggregate(18, bestFunc)"
                [worsts]="aggregate(18, worstFunc)" />
            <app-level-container level="19" [r]="255"[g]="184" [b]="0"
                [labels]="['Subscore','Tetris rate','Right well open','Tetris ready']"
                [averages]="aggregate(19, averageFunc)"
                [medians]="aggregate(19, medianFunc)"
                [bests]="aggregate(19, bestFunc)"
                [worsts]="aggregate(19, worstFunc)" />
            <app-level-container level="29" [r]="255"[g]="0" [b]="0"
                [labels]="['Subscore','Tetris rate','Right well open','Tetris ready']"
                [averages]="aggregate(29, averageFunc)"
                [medians]="aggregate(29, medianFunc)"
                [bests]="aggregate(29, bestFunc)"
                [worsts]="aggregate(29, worstFunc)" />
        </div>
    </app-section>

</div>